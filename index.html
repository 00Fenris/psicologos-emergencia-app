<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Psic√≥logos Emergencia</title>
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link rel="stylesheet" href="styles.css">
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="firebaseConfig.js"></script>
  <script src="app.js" defer></script>
</head>
<body>
  <!-- Bloque de login y registro -->
  <div id="login" class="center">
    <div class="login-container">
      <div class="login-header">
        <div class="logo">
          <div class="logo-icon">üß†</div>
          <h1>Psic√≥logos Emergencia</h1>
        </div>
        <p class="subtitle">Sistema de gesti√≥n de disponibilidad</p>
      </div>
      
      <div class="login-card">
        <div class="tab-container">
          <button class="tab active" id="tabUsuarios">Psic√≥logos / Coordinadores</button>
          <button class="tab" id="tabAdmin">Administraci√≥n</button>
        </div>
        
        <!-- Panel Unificado Psic√≥logos/Coordinadores -->
        <div id="panelUsuarios" class="tab-content active">
          <h2>Acceso Sistema</h2>
          <div class="form-group">
            <label for="emailLogin">Email</label>
            <input id="emailLogin" type="email" placeholder="tu@email.com" autocomplete="email" />
          </div>
          <div class="form-group">
            <label for="passwordLogin">Contrase√±a</label>
            <input id="passwordLogin" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password" />
          </div>
          <button id="btnLogin" class="btn-primary">Iniciar Sesi√≥n</button>
          <button id="btnRegister" class="btn-secondary">Registrarse como Psic√≥logo</button>
          
          <!-- Campos adicionales para registro (ocultos por defecto) -->
          <div id="registerFields" class="register-fields" style="display:none;">
            <div class="form-group">
              <label for="emailRegister">Email para registro</label>
              <input id="emailRegister" type="email" placeholder="nuevo@email.com" />
            </div>
            <div class="form-group">
              <label for="passwordRegister">Contrase√±a</label>
              <input id="passwordRegister" type="password" placeholder="M√≠nimo 6 caracteres" />
            </div>
          </div>
        </div>
        
        <!-- Panel Administraci√≥n -->
        <div id="panelAdminTab" class="tab-content">
          <h2>Panel Administrativo</h2>
          <div class="admin-options">
            <div class="admin-card">
              <div class="admin-icon">‚öôÔ∏è</div>
              <h3>Acceso Administrador</h3>
              <p>Solo para administradores del sistema</p>
              <div class="form-group">
                <input id="adminEmailAccess" type="email" placeholder="Email administrador" />
              </div>
              <div class="form-group">
                <input id="adminPasswordAccess" type="password" placeholder="Contrase√±a administrador" />
              </div>
              <button id="btnAdminAccess" class="btn-admin">Acceder al Panel</button>
              <div style="font-size:0.8em;color:#666;margin-top:10px;">
                <strong>Demo:</strong> test@mail.com / 123456
              </div>
            </div>
          </div>
        </div>
        
        <div id="loginError" class="error-message"></div>
      </div>
    </div>
  </div>

  <!-- Vista Psic√≥logo -->
  <div id="vistaPsicologo" class="hidden">
    <header>
      <h1>Registro de disponibilidad</h1>
      <button id="btnSalirPsicologo" style="float:right;background:#718096;">Salir</button>
    </header>
    <div class="card" style="max-width:400px;margin:0 auto;">
      <form id="formPsico1" autocomplete="off">
        <label for="nombre">Nombre completo</label>
        <input id="nombre1" name="nombre" type="text" required />
        <label for="telefono">Tel√©fono</label>
        <input id="telefono1" name="telefono" type="tel" placeholder="Ej: +34 600 123 456" required autocomplete="tel" />
        <label for="zona">Zona</label>
        <input id="zona1" name="zona" type="text" required autocomplete="off" />
        <div id="zona-sugerencias" class="sugerencias"></div>
        <label for="semana">Semana</label>
        <input id="semana1" name="semana" type="week" required autocomplete="off" />
        <label for="turno">Turno</label>
        <select id="turno1" name="turno" required>
          <option value="">-- Selecciona un turno --</option>
          <option>Ma√±ana</option>
          <option>Tarde</option>
          <option>Noche</option>
        </select>
        <label for="notas">Notas (opcional)</label>
        <input id="notas1" name="notas" type="text" autocomplete="off" />
        <button type="submit">Guardar</button>
      </form>
    </div>
    
    <!-- Sistema de Informes para Psic√≥logos -->
    <div class="card" style="max-width:500px;margin:20px auto;">
      <h3>üìã Subir Informe de Salida</h3>
      <form id="formInforme">
        <div class="form-group">
          <label for="tipoSalida">Tipo de Salida</label>
          <select id="tipoSalida" required>
            <option value="">-- Selecciona tipo --</option>
            <option value="emergencia">Emergencia</option>
            <option value="consulta_programada">Consulta Programada</option>
            <option value="seguimiento">Seguimiento</option>
            <option value="intervencion_crisis">Intervenci√≥n Crisis</option>
          </select>
        </div>
        <div class="form-group">
          <label for="ubicacionSalida">Ubicaci√≥n</label>
          <input id="ubicacionSalida" type="text" placeholder="Direcci√≥n o lugar de la salida" required />
        </div>
        <div class="form-group">
          <label for="fechaSalida">Fecha y Hora</label>
          <input id="fechaSalida" type="datetime-local" required />
        </div>
        <div class="form-group">
          <label for="duracionSalida">Duraci√≥n (minutos)</label>
          <input id="duracionSalida" type="number" placeholder="Ej: 60" min="1" required />
        </div>
        <div class="form-group">
          <label for="pacientesAtendidos">Pacientes Atendidos</label>
          <input id="pacientesAtendidos" type="number" placeholder="N√∫mero de pacientes" min="1" required />
        </div>
        <div class="form-group">
          <label for="observacionesInforme">Observaciones</label>
          <textarea id="observacionesInforme" rows="3" placeholder="Detalles importantes de la salida..."></textarea>
        </div>
        <button type="submit" class="btn-primary">Subir Informe</button>
      </form>
    </div>
    
    <div class="card" style="max-width:400px;margin:20px auto;">
      <h3>üí¨ Chat con Coordinador</h3>
      <div id="chatPsico" class="chat"></div>
      <div class="chat-input-container">
        <input id="msgPsico1" type="text" placeholder="Escribe tu mensaje..." />
        <button id="btnSendPsico" class="btn-primary">Enviar</button>
      </div>
    </div>
  </div>

  <!-- Vista Coordinador -->
  <div id="vistaCoordinador" class="hidden">
    <header>
      <h1>Panel Coordinador</h1>
      <button id="btnSalirCoordinador" style="float:right;background:#718096;">Salir</button>
    </header>
    
    <div class="coordinator-dashboard">
      <div class="card">
        <h3>üìä Resumen de Actividad</h3>
        <div class="stats-grid">
          <div class="stat-item">
            <span class="stat-number" id="statPsicologosActivos">--</span>
            <span class="stat-label">Psic√≥logos Activos</span>
          </div>
          <div class="stat-item">
            <span class="stat-number" id="statSalidasHoy">--</span>
            <span class="stat-label">Salidas Hoy</span>
          </div>
          <div class="stat-item">
            <span class="stat-number" id="statPacientesSemana">--</span>
            <span class="stat-label">Pacientes esta Semana</span>
          </div>
        </div>
      </div>
      
      <div class="card">
        <h3>üö® Psic√≥logos Disponibles</h3>
        <div id="listaPsicologosDisponibles">
          <p>Cargando psic√≥logos disponibles...</p>
        </div>
      </div>
      
      <!-- Chat con Administrador -->
      <div class="card">
        <h3>üí¨ Chat con Administrador</h3>
        <div id="chatCoordinadorAdmin" class="chat" style="height:200px;overflow-y:auto;border:1px solid #e2e8f0;border-radius:6px;padding:10px;background:#f9fafb;margin-bottom:10px;">
          <p style="color:#666;text-align:center;">Chat con el administrador del sistema</p>
        </div>
        <div style="display:flex;gap:10px;">
          <input id="msgCoordinadorAdmin" type="text" placeholder="Escribe tu mensaje al admin..." style="flex:1;" />
          <button id="btnSendCoordinadorAdmin" class="btn-primary" style="padding:8px 16px;">Enviar</button>
        </div>
      </div>
    </div>
    <div class="card" style="max-width:600px;margin:0 auto;">
      <label for="filtroDia">Filtrar por d√≠a</label>
      <input id="filtroDia" type="date" />
      <label for="filtroZona">Filtrar por zona</label>
      <input id="filtroZona" type="text" autocomplete="off" />
      <div id="filtroZona-sugerencias" class="sugerencias"></div>
      <label for="filtroTurno">Filtrar por turno</label>
      <select id="filtroTurno">
        <option value="">-- Todos los turnos --</option>
        <option>Ma√±ana</option>
        <option>Tarde</option>
        <option>Noche</option>
      </select>
      <div style="display:flex;gap:8px;margin-top:10px">
        <button id="btnVerTodos" class="small">Ver todos</button>
        <button id="btnDescargarPDF" class="small" style="background:#38a169">Descargar PDF</button>
        <button id="btnBorrarTodo" class="small btn-borrar-todo">Borrar todo</button>
      </div>
      <hr />
      <div id="listadoContainer" style="max-height:460px;overflow:auto"></div>
    </div>
    <div class="card" style="max-width:600px;margin:20px auto;">
      <h3>üí¨ Chat con Psic√≥logos</h3>
      <label for="filtroTurnoPsico">Filtrar psic√≥logos por turno:</label>
      <div id="filtroTurnoPsico" style="margin-bottom:10px;">
        <label><input type="checkbox" value="Ma√±ana"> Ma√±ana</label>
        <label><input type="checkbox" value="Tarde"> Tarde</label>
        <label><input type="checkbox" value="Noche"> Noche</label>
        <button id="btnFiltrarPsico" class="small">Aplicar Filtro</button>
      </div>
      <label for="selectPsico">Selecciona psic√≥logo:</label>
      <select id="selectPsico" style="width:100%;margin-bottom:10px"></select>
      <div id="chatCoord" class="chat"></div>
      <div class="chat-input-container">
        <input id="msgCoord1" type="text" placeholder="Escribe tu mensaje..." />
        <button id="btnSendCoord" class="btn-primary">Enviar</button>
      </div>
    </div>
  </div>

  <!-- Panel Admin SOLO para Administradores -->
  <div id="panelAdmin" class="hidden">
    <header>
      <h1>üîê Panel Administrativo</h1>
      <button id="btnSalirAdmin" style="float:right;background:#718096;">Salir</button>
    </header>
    
    <!-- Dashboard de Estad√≠sticas Avanzadas -->
    <div class="admin-dashboard">
      <div class="stats-container">
        <div class="stat-card">
          <div class="stat-icon">üë•</div>
          <div class="stat-content">
            <span class="stat-number" id="statPsicologos">--</span>
            <span class="stat-label">Psic√≥logos Registrados</span>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">üë®‚Äçüíº</div>
          <div class="stat-content">
            <span class="stat-number" id="statCoordinadores">--</span>
            <span class="stat-label">Coordinadores</span>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">üö®</div>
          <div class="stat-content">
            <span class="stat-number" id="statSalidasMes">--</span>
            <span class="stat-label">Salidas este Mes</span>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">üìÖ</div>
          <div class="stat-content">
            <span class="stat-number" id="statSemana">--</span>
            <span class="stat-label">Registros Semana</span>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">üè•</div>
          <div class="stat-content">
            <span class="stat-number" id="statPacientesTotales">--</span>
            <span class="stat-label">Pacientes Atendidos</span>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">‚è±Ô∏è</div>
          <div class="stat-content">
            <span class="stat-number" id="statTiempoPromedio">--</span>
            <span class="stat-label">Tiempo Promedio (min)</span>
          </div>
        </div>
      </div>
      
      <!-- Estad√≠sticas por Psic√≥logo -->
      <div class="card">
        <h3>üìä Rendimiento por Psic√≥logo</h3>
        <div class="table-container">
          <table id="tablaPsicologos">
            <thead>
              <tr>
                <th>Psic√≥logo</th>
                <th>Salidas</th>
                <th>Pacientes</th>
                <th>Zonas Cubiertas</th>
                <th>Tiempo Total (hrs)</th>
                <th>√öltima Actividad</th>
              </tr>
            </thead>
            <tbody id="tablaPsicologosBody">
              <tr><td colspan="6">Cargando datos...</td></tr>
            </tbody>
          </table>
        </div>
      </div>
      
      <!-- Gesti√≥n de Coordinadores -->
      <div class="card">
        <h3>üë®‚Äçüíº Gesti√≥n de Coordinadores</h3>
        <div style="display:flex;gap:20px;">
          <div style="flex:1;">
            <h4>Registrar Nuevo Coordinador</h4>
            <div class="form-group">
              <input id="adminEmail" type="email" placeholder="Email del coordinador" />
            </div>
            <div class="form-group">
              <input id="adminPassword" type="password" placeholder="Contrase√±a (min. 6 caracteres)" />
            </div>
            <button id="btnCrearCoordinador" class="btn-primary">Crear Coordinador</button>
            <div id="adminError" style="margin-top:10px;"></div>
          </div>
          <div style="flex:1;">
            <h4>Lista de Coordinadores 
              <button id="btnRefrescarCoordinadores" class="btn-secondary" style="font-size:0.8em;padding:4px 8px;">üîÑ Refrescar</button>
            </h4>
            <div id="listaCoordinadores" style="max-height:200px;overflow-y:auto;border:1px solid #e2e8f0;border-radius:6px;">
              <p style="text-align:center;padding:20px;">Cargando coordinadores...</p>
            </div>
          </div>
        </div>
      </div>
      
      <!-- An√°lisis de Zonas -->
      <div class="card">
        <h3>üó∫Ô∏è An√°lisis por Zonas</h3>
        <div id="estadisticasZonas" style="max-height:300px;overflow-y:auto;">
          <p>Cargando estad√≠sticas de zonas...</p>
        </div>
      </div>
      
      <!-- Chat con Coordinadores -->
      <div class="card">
        <h3>üí¨ Chat con Coordinadores</h3>
        <div class="chat-section">
          <div class="form-group">
            <label for="selectCoordinador">Selecciona coordinador:</label>
            <select id="selectCoordinador" style="width:100%;margin-bottom:10px;">
              <option value="">-- Selecciona un coordinador --</option>
            </select>
            <button id="btnRefrescarCoordinadoresChat" class="btn-secondary" style="font-size:0.8em;padding:4px 8px;">üîÑ Refrescar</button>
          </div>
          <div id="chatAdmin" class="chat" style="height:200px;overflow-y:auto;border:1px solid #e2e8f0;border-radius:6px;padding:10px;background:#f9fafb;margin-bottom:10px;">
            <p style="color:#666;text-align:center;">Selecciona un coordinador para iniciar el chat</p>
          </div>
          <div style="display:flex;gap:10px;">
            <input id="msgAdmin" type="text" placeholder="Escribe tu mensaje..." style="flex:1;" />
            <button id="btnSendAdmin" class="btn-primary" style="padding:8px 16px;">Enviar</button>
          </div>
        </div>
      </div>
    </div>
  </div>
        </div>
        <div style="flex:1;">
          <h3>Login Coordinador</h3>
          <input id="coordEmail" type="email" placeholder="Email coordinador" style="width:100%;margin-bottom:10px;" />
          <input id="coordPassword" type="password" placeholder="Contrase√±a" style="width:100%;margin-bottom:10px;" />
          <button id="btnLoginCoord" style="background:#4299e1;">Acceder como Coordinador</button>
        </div>
      </div>
      
      <div style="margin-bottom:30px;">
        <h3>Coordinadores Registrados</h3>
        <div id="listaCoordinadores" style="max-height:200px;overflow-y:auto;border:1px solid #e2e8f0;border-radius:8px;padding:10px;">
          <p style="color:#666;text-align:center;">Cargando...</p>
        </div>
        <button id="btnRefrescarCoordinadores" style="margin-top:10px;background:#6b7280;">Refrescar Lista</button>
      </div>
      <div style="margin-top:30px;">
        <h3>Estad√≠sticas</h3>
        <div id="statsPanel" style="display:grid;grid-template-columns:repeat(3,1fr);gap:20px;">
          <div class="stat-card">
            <h4>Psic√≥logos Registrados</h4>
            <div id="statPsicologos" style="font-size:2em;color:#38a169;">0</div>
          </div>
          <div class="stat-card">
            <h4>Coordinadores</h4>
            <div id="statCoordinadores" style="font-size:2em;color:#4299e1;">0</div>
          </div>
          <div class="stat-card">
            <h4>Registros Esta Semana</h4>
            <div id="statSemana" style="font-size:2em;color:#ed8936;">0</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>
</html>
